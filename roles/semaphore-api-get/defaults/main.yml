---
# defaults file for semaphore-api-get

# API base URL - typically provided by semaphore_ui_api fact
semaphore_api_base_url: "{{ semaphore_ui_api | default('http://localhost:3000/api') }}"

# API authentication
# Token authentication is preferred; basic auth used as fallback
semaphore_api_token: ""
semaphore_api_user: "admin"
semaphore_api_password: "changeme"

# ==============================================
# Vault Token Management
# ==============================================

# Path to Ansible vault file containing semaphore_api_token
# Set to empty string to disable vault integration
semaphore_api_vault_file: "{{ playbook_dir }}/secrets/vault.yml"

# Vault password file path (optional - can use --vault-password-file or env var)
semaphore_api_vault_password_file: ""

# Automatically create a new API token if none exists in vault or as fact
# Requires valid semaphore_api_user and semaphore_api_password
semaphore_api_auto_create_token: true

# Endpoint to call (27 endpoints available)
# Global endpoints: ping, info, projects, users, user, user_tokens, events_last
# Project endpoints: project, inventory, task, tasks_last, task_output, task_raw_output,
#                    variable_groups, repository, keys, templates, schedules, events,
#                    views, backup, project_users, project_role
# Integration endpoints: integrations, integration, integration_matchers, integration_values
semaphore_api_endpoint: ""

# Project ID for API calls (required for project-scoped endpoints)
semaphore_project_id: 1

# Resource ID for specific resource lookups
# Optional for most endpoints, required for: task_output, task_raw_output,
# integration, integration_matchers, integration_values
semaphore_resource_id: ""

# Additional query parameters (optional)
# Example: { "sort": "name", "order": "asc" }
semaphore_api_query_params: {}

# Retry settings for API calls
# Retries: 0-10, Delay: 0-300 seconds
semaphore_api_retries: 3
semaphore_api_retry_delay: 5

# Debug output control
semaphore_api_debug: true
semaphore_api_verbose_debug: false

# HTTP request settings
semaphore_api_validate_certs: true
semaphore_api_timeout: 30  # 1-600 seconds
semaphore_api_follow_redirects: "all"

# Response handling
semaphore_api_return_content: true
semaphore_api_status_code: 200
semaphore_api_expected_status_codes: [200]
semaphore_api_validate_json: true
semaphore_api_store_metadata: true

# ==============================================
# Endpoint Examples
# ==============================================

# Global endpoints (do not require project_id)
# ---------------------------------------------

# Health check - verify API is responding
# Returns: { "message": "pong" }
semaphore_api_ping_example:
  endpoint: "ping"

# System information - version, features
# Returns: { "version": "2.x.x", ... }
semaphore_api_info_example:
  endpoint: "info"

# List all projects
semaphore_api_projects_example:
  endpoint: "projects"

# Current authenticated user
semaphore_api_user_example:
  endpoint: "user"

# Current user's API tokens
semaphore_api_user_tokens_example:
  endpoint: "user_tokens"

# All users (admin only)
semaphore_api_users_example:
  endpoint: "users"

# Last 200 global events (optimized)
semaphore_api_events_last_example:
  endpoint: "events_last"

# Project-scoped endpoints (require project_id)
# ---------------------------------------------

# Single project details
semaphore_api_project_example:
  endpoint: "project"
  project_id: 1

# All inventories for a project
semaphore_api_inventory_example:
  endpoint: "inventory"
  project_id: 1
  resource_id: ""  # Optional: specific inventory ID

# All tasks for a project
semaphore_api_task_example:
  endpoint: "task"
  project_id: 1
  resource_id: ""  # Optional: specific task ID

# Last 200 tasks (optimized)
semaphore_api_tasks_last_example:
  endpoint: "tasks_last"
  project_id: 1

# Task output (structured JSON)
semaphore_api_task_output_example:
  endpoint: "task_output"
  project_id: 1
  resource_id: "42"  # Required: task ID

# Task output (plain text)
semaphore_api_task_raw_output_example:
  endpoint: "task_raw_output"
  project_id: 1
  resource_id: "42"  # Required: task ID

# Environment variable groups
semaphore_api_variable_groups_example:
  endpoint: "variable_groups"
  project_id: 1

# Repositories
semaphore_api_repository_example:
  endpoint: "repository"
  project_id: 1

# SSH/access keys
semaphore_api_keys_example:
  endpoint: "keys"
  project_id: 1

# Task templates
semaphore_api_templates_example:
  endpoint: "templates"
  project_id: 1

# Scheduled tasks
semaphore_api_schedules_example:
  endpoint: "schedules"
  project_id: 1

# Project activity/events log
semaphore_api_events_example:
  endpoint: "events"
  project_id: 1

# Template views/groups
semaphore_api_views_example:
  endpoint: "views"
  project_id: 1

# Project backup/export
semaphore_api_backup_example:
  endpoint: "backup"
  project_id: 1

# Project user assignments
semaphore_api_project_users_example:
  endpoint: "project_users"
  project_id: 1

# Current user's role in project
semaphore_api_project_role_example:
  endpoint: "project_role"
  project_id: 1

# Integration endpoints (require project_id)
# ------------------------------------------

# All integrations for a project
semaphore_api_integrations_example:
  endpoint: "integrations"
  project_id: 1

# Single integration details
semaphore_api_integration_example:
  endpoint: "integration"
  project_id: 1
  resource_id: "1"  # Required: integration ID

# Integration matchers
semaphore_api_integration_matchers_example:
  endpoint: "integration_matchers"
  project_id: 1
  resource_id: "1"  # Required: integration ID

# Extracted integration values
semaphore_api_integration_values_example:
  endpoint: "integration_values"
  project_id: 1
  resource_id: "1"  # Required: integration ID
